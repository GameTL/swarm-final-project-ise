"""turtlebot_controller controller."""

from controller import Robot, Camera, Motor, RangeFinder

MAX_SPEED = 0.5

# create the Robot instance.
robot = Robot()

# get the time step of the current world.
timestep = int(robot.getBasicTimeStep())

#RGB camera
camera = robot.getDevice("camera")
camera.enable(timestep)
camera.recognitionEnable(timestep)

#Range Finder as Depth camera
depthCam = robot.getDevice("range-finder")
depthCam.enable(timestep)

#turtlebot
leftMotor = robot.getDevice('left wheel motor')
rightMotor = robot.getDevice('right wheel motor')
leftMotor.setPosition(float('inf'))
rightMotor.setPosition(float('inf'))
leftMotor.setVelocity(0)
rightMotor.setVelocity(0)

#motion
def left_spin():
    leftMotor.setVelocity(-0.7 * MAX_SPEED)
    rightMotor.setVelocity(0.7 * MAX_SPEED)

def right_spin():
    leftMotor.setVelocity(0.7 * MAX_SPEED)
    rightMotor.setVelocity(-0.7 * MAX_SPEED)

def stop():
    leftMotor.setVelocity(0)
    rightMotor.setVelocity(0)

#rotating around until yellow cube is found
#stop and face towards the target, the target has to be in the center of the frame
#get data -> object size and distance from the robot
#three robot must do the same
done = 0
while done != 1:
    leftMotor.setVelocity(MAX_SPEED)
    rightMotor.setVelocity(-MAX_SPEED)
    
    number_of_objects = camera.getRecognitionNumberOfObjects()
    objects = camera.getRecognitionObjects()
    print(f"\nRecognized {number_of_objects} objects.")
    
    camera_width = camera.getWidth()
    camera_height = camera.getHeight()
    
    for obj in objects:
      color = obj.getColors()
      r, g, b = color[0], color[1], color[2]  # RGB values
      print(f"Color: {r}, {g}, {b}")
      
      if r == 1.0 and g == 1.0 and b == 0.0:
          print("Yellow cube found! Stopping the robot.")
          #leftMotor.setVelocity(0)
          #rightMotor.setVelocity(0)
          image_position = obj.getPositionOnImage()
          print('[goal found!!!]')
          for i in image_position:
              print(i)
          if image_position[0] < 35:
             left_spin() #left spin
          elif image_position[0] > 35:
             right_spin() #right spin
          else:
              stop()
              done = 1
print([obj.getPosition(),obj.getOrientation(), obj.getSize()])
   